# Generated Files - Structure & Watch Mode

## Overview

TypeScript declarations and React wrappers are **automatically generated** and stored in `src/generated/`.

## Directory Structure

```
src/
â”œâ”€â”€ components/          # Your component source code (EDIT THESE)
â”‚   â”œâ”€â”€ button/
â”‚   â”œâ”€â”€ modal/
â”‚   â””â”€â”€ text/
â”œâ”€â”€ generated/          # Auto-generated files (DO NOT EDIT)
â”‚   â”œâ”€â”€ jsx.d.ts       # TypeScript JSX declarations
â”‚   â””â”€â”€ react.tsx      # React wrapper components
â””â”€â”€ index.js           # Main library entry
```

## Generated Files Location

### âœ… src/generated/ (Current Setup)

**Generated files are in:**
- `src/generated/jsx.d.ts`
- `src/generated/react.tsx`

**Benefits:**
- âœ… Clearly separated from source code
- âœ… Added to `.gitignore` (not tracked)
- âœ… IDE can find types during development
- âœ… Regenerated automatically on component changes

## Gitignore

Generated files are **not tracked** in git:

```gitignore
# .gitignore
src/generated/
```

This means:
- Generated files won't show up in `git status`
- Won't be committed to the repository
- Each developer generates them locally
- CI/CD must run `npm run generate:types` before building

## Commands

### Manual Generation

```bash
# Generate types once
npm run generate:types
```

### Watch Mode (Auto-Regeneration)

```bash
# Watch component files and auto-regenerate on changes
npm run generate:watch
```

**Watch mode output:**
```
ğŸ‘€ Watching for component changes...
ğŸ“‚ Watching: /path/to/src/components

âš¡ Regenerating types...
ğŸ” Scanning components...
  âœ“ Found component: button
  âœ“ Found component: modal
  âœ“ Found component: text

ğŸ“ Generating files for 3 components...
  âœ“ Generated: src/generated/jsx.d.ts
  âœ“ Generated: src/generated/react.tsx

âœ¨ Code generation complete!
âœ… Types regenerated successfully

Press Ctrl+C to stop watching

ğŸ“ Changed: button/index.ts
âš¡ Regenerating types...
...
```

### Build (Includes Generation)

```bash
# Automatically generates types before building
npm run build
```

Build process:
1. âœ… Runs `generate:types`
2. âœ… Builds main library
3. âœ… Builds React library

## Development Workflow

### Option 1: Watch Mode (Recommended)

```bash
# Terminal 1: Watch and regenerate types
npm run generate:watch

# Terminal 2: Run Storybook or dev server
npm run storybook
```

Every time you edit a component file, types automatically regenerate!

### Option 2: Manual Generation

```bash
# 1. Edit component
vim src/components/button/index.ts

# 2. Regenerate types
npm run generate:types

# 3. Continue development
```

## When Types Regenerate

Types regenerate automatically when:

âœ… **Watch mode is running** AND you modify:
- Any `.ts` file in `src/components/`
- Component attributes (`observedAttributes`)
- Type definitions
- Const arrays

âŒ **Types DO NOT regenerate** for:
- Test files (`*.test.ts`)
- CSS files (`*.css`)
- Story files (`*.stories.ts`)
- Files outside `src/components/`

## What Happens on Git Clone?

When someone clones the repository:

```bash
git clone <repo>
cd vite-web-component-library
npm install

# Generated files DON'T exist yet!
# Must generate them:
npm run generate:types

# Or just build (which generates automatically):
npm run build
```

## CI/CD Setup

Your CI/CD pipeline must generate files before building:

```yaml
# Example: GitHub Actions
steps:
  - uses: actions/checkout@v3
  - uses: actions/setup-node@v3
  - run: npm install
  - run: npm run build  # Includes generate:types
```

**Important:** Don't run `npm run build:main` or `npm run build:react` directly in CI. Always use `npm run build` which includes generation.

## Troubleshooting

### Generated Files Missing

**Problem:** Import errors for `src/generated/jsx.d.ts` or `src/generated/react.tsx`

**Solution:**
```bash
npm run generate:types
```

### Types Out of Sync

**Problem:** TypeScript errors after modifying component attributes

**Solution:**
```bash
npm run generate:types
```

### Watch Mode Not Working

**Problem:** Changes to components don't trigger regeneration

**Check:**
1. Is watch mode running? (`npm run generate:watch`)
2. Are you editing `.ts` files in `src/components/`?
3. Are you editing test files? (These are ignored)

**Solution:** Restart watch mode:
```bash
# Ctrl+C to stop
npm run generate:watch
```

### Build Fails with "Cannot find module"

**Problem:** Build fails looking for generated files

**Solution:** Ensure generation runs first:
```bash
# Don't do this:
npm run build:main  # âŒ Skips generation

# Do this:
npm run build       # âœ… Includes generation
```

## File Headers

Generated files include a warning header:

```typescript
/**
 * TypeScript JSX declarations for fvr- web components
 * This file is AUTO-GENERATED by scripts/generate-types.cjs
 * Do not edit manually - changes will be overwritten
 */
```

**Never edit these files manually.** Changes will be overwritten on next generation.

## Import Paths

### For Consumers (Published Package)

```typescript
// Types
import 'vite-web-component-library/jsx';

// React wrappers
import { Button } from 'vite-web-component-library/react';
```

### For Development (Within This Repo)

```typescript
// Types
import '../src/generated/jsx.d.ts';

// React wrappers
import { Button } from '../src/generated/react.tsx';
```

## Package Exports

The generated files are exported in `package.json`:

```json
{
  "exports": {
    "./jsx": {
      "types": "./dist/types/generated/jsx.d.ts"
    },
    "./react": {
      "import": "./dist/react.es.js",
      "types": "./dist/types/generated/react.d.ts"
    }
  }
}
```

## Benefits of This Structure

âœ… **Clean separation** - Source vs generated code
âœ… **Not in git** - Reduces repo size and merge conflicts
âœ… **Always fresh** - Regenerated from source
âœ… **IDE support** - TypeScript finds types during development
âœ… **Watch mode** - Auto-regenerate on changes
âœ… **Explicit** - Clear what's generated vs source

## Comparison with Alternatives

### Why not `dist/`?

```
âŒ dist/generated/jsx.d.ts
```

**Problems:**
- Need to build before development works
- IDE can't find types without building first
- Can't import from source during development

### Why not root `generated/`?

```
âŒ generated/jsx.d.ts
```

**Problems:**
- Import paths become awkward
- Not grouped with source code
- Less clear it's related to `src/`

### Why not keep in `src/`?

```
âŒ src/jsx.d.ts
âŒ src/react.tsx
```

**Problems:**
- Looks like source code
- Easy to accidentally edit
- Mixed with real source files

## Summary

- âœ… Generated files in `src/generated/`
- âœ… Added to `.gitignore`
- âœ… Watch mode for auto-regeneration
- âœ… Regenerates on component file changes
- âœ… Clear separation from source code
- âœ… Must generate before first build after clone

**Workflow:**
```bash
# Development with watch mode
npm run generate:watch  # Terminal 1
npm run storybook       # Terminal 2

# Or manual
npm run generate:types  # After editing components
npm run build          # Includes generation
```
